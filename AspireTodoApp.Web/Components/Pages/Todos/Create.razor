@page "/todos/create"
@using AspireTodoApp.Web.ApiClients
@using AspireTodoApp.Web.Models.Forms

@inject NavigationManager Navigation
@inject TodoApiClient TodoApi

<h1>Todo作成</h1>

<NavLink href="/todos">戻る</NavLink>

@if (!string.IsNullOrEmpty(_statusMessage))
{
    <p style="color: red;">@_statusMessage</p>
}

<EditForm Model="Model" OnValidSubmit="Submit" FormName="TodoCreate">
    <DataAnnotationsValidator />
    <ValidationSummary />
    <div>
        <label>Name:<InputText @bind-Value="Model!.Name" /></label>
    </div>
    <div>
        <label>IsComplete:<InputCheckbox @bind-Value="Model.IsComplete" /></label>
    </div>
    <div>
        <button type="submit">Submit</button>
    </div>
</EditForm>

@code {
    private string? _statusMessage;
    [SupplyParameterFromForm]
    private CreateTodoForm? Model { get; set; }

    protected override void OnInitialized() => Model ??= new();
    private async Task Submit()
    {
        var response = await TodoApi.PostTodoItemAsync(Model!);
        if (response.IsSuccessStatusCode)
        {
            Navigation.NavigateTo("/todos"); 
        }
        else
        {
            _statusMessage = "登録に失敗しました。";
        }
    }

}
